From 93fe4fc92050214dcd43ae12613f8d41f8e7d178 Mon Sep 17 00:00:00 2001
From: James Le Cuirot <chewi@gentoo.org>
Date: Wed, 27 Dec 2017 11:31:58 +0000
Subject: [PATCH 05/10] Allow GUI to be explicitly enabled or disabled with
 configure

Linux distributions hate automagic dependencies. :)
---
 configure.ac | 20 +++++++++++++++++---
 1 file changed, 17 insertions(+), 3 deletions(-)

diff --git a/configure.ac b/configure.ac
index b0eca1e..d57dcae 100644
--- a/configure.ac
+++ b/configure.ac
@@ -30,6 +30,10 @@ AC_MSG_CHECKING([whether to enable donator features])
 AS_IF([test "x${enable_donator}" = "xno"], AC_MSG_RESULT([no]), AC_MSG_RESULT([yes]))
 AM_CONDITIONAL([ENABLE_DONATOR], [test "x${enable_donator}" != "xno"])
 
+AC_ARG_ENABLE([gui], AS_HELP_STRING([--disable-gui], [build without the graphical user interface]))
+AC_MSG_CHECKING([whether to enable the graphical user interface])
+AS_CASE([x${enable_gui}], [xno], [AC_MSG_RESULT([no])], [x?*], [AC_MSG_RESULT([yes])], [AC_MSG_RESULT([if possible])])
+
 AC_ARG_ENABLE([static], [AS_HELP_STRING([--enable-static], [build a statically linked binary])])
 AC_MSG_CHECKING([whether to build a statically linked binary])
 AS_IF([test "x${enable_static}" = "xyes"], AC_MSG_RESULT([yes]), AC_MSG_RESULT([no]))
@@ -47,9 +51,19 @@ AS_IF([test "x${enable_static}" = "xyes"], PKG_CONFIG="$PKG_CONFIG --static")
 PKG_CHECK_MODULES(argtable2, [argtable2 >= 2.12])
 PKG_CHECK_MODULES(ffmpeg, [libavutil >= 54.7 libavformat >= 56.4 libavcodec >= 56.1])
 
-PKG_CHECK_MODULES(sdl, [sdl >= 1.2.0], has_sdl=yes, has_sdl=no)
-AC_MSG_CHECKING([whether to build the graphical user interface])
-AC_MSG_RESULT([$has_sdl])
+AS_IF([test "x${enable_gui}" = "xno"], [
+    has_sdl=no
+], [
+    AS_IF([test "x${enable_gui}" != "x"], [
+        PKG_CHECK_MODULES(sdl, [sdl >= 1.2.0], has_sdl=yes)
+    ], [
+        PKG_CHECK_MODULES(sdl, [sdl >= 1.2.0], has_sdl=yes, has_sdl=no)
+    ])
+
+    AC_MSG_CHECKING([whether we can build the graphical user interface])
+    AC_MSG_RESULT([$has_sdl])
+])
+
 AM_CONDITIONAL([BUILD_GUI], [test "x${has_sdl}" = "xyes"])
 AM_PROG_CC_C_O
 
-- 
2.14.3

